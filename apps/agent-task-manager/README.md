# Agent Task Manager

**Welcome to the Agent Task Manager worker!**  
This is a Cloudflare Worker (with a Durable Object) that listens for task-related instructions and intelligently manages a list of tasks. It is designed to interpret your requests, either adding tasks, removing tasks, listing tasks, or doing nothing if it deems that no changes are needed. The results of its decisions can then be retrieved and incorporated into your applications as you see fit.

## Overview

This worker:
- Provides a POST endpoint at `/` that accepts a JSON payload containing a user prompt.
- Uses advanced AI capabilities to interpret user input and decide the most appropriate task-based action:
  1. **Add** a new task,  
  2. **Delete** an existing task,  
  3. **List** all existing tasks,  
  4. **Do nothing** (if the query does not suggest a modification to the task list).
- Persists these tasks in a Durable Object called `TASK_MANAGER_AGENT`.

## How It Works

1. **POST Request**  
   A request is made to `/` with a JSON body:
   ```json
   {
     "agentId": "some-agent-identifier",
     "prompt": "some user prompt"
   }
   ```
- **`agentId`**: Used to instantiate a specific instance of the `TaskManagerAgent` Durable Object.
- **`prompt`**: A textual prompt describing the user's request (e.g., *“Add a new task called ‘Fix the boiler’”* or *“Remove the task ‘Shopping’”*).

2. **Intelligent Decision**  
   The worker consults the AI model (bound to `AI`) and interprets the prompt. The AI will respond with a JSON structure indicating whether to add, delete, list tasks, or take no action.

3. **Task Modification**
  - **Add**: Creates a new task with a unique UUID.
  - **Delete**: Removes a task by matching its identifier.
  - **List**: Returns all current tasks.
  - **None**: Indicates no changes are necessary.

4. **Response**  
   The worker replies with one of the following:
  - The newly added task (if adding).
  - A boolean or string (if deleting).
  - An array of all tasks (if listing).
  - A short message or `undefined` (in other circumstances).

### Durable Object

- **`TaskManagerAgent`**: Contains logic for all task management operations, as well as the internal state of tasks in memory.
- The `taskId` values are generated by `crypto.randomUUID()`, ensuring uniqueness.

## Setting Up and Running Locally

1. **Prerequisites**
  - Node.js and npm installed.
  - A Cloudflare account for production deployment (optional if you merely want to run locally).

2. **Installation**  
   In the monorepo’s root directory, install dependencies:
   ```bash
   npm install
   ```

3. **Run (Development Mode)**  
   Start the worker in development mode with Nx:
   ```bash
   npx nx dev agent-task-manager
   ```
   This effectively calls `wrangler dev`, spinning up a local environment so that you can send requests to `http://localhost:8787/` (default port).

4. **Deployment**  
   If you have your Cloudflare account set up (with the required credentials in `wrangler.toml` or environment variables), you may deploy using:
   ```bash
   npm run deploy
   ```
   or:
   ```bash
   npx nx run agent-task-manager:deploy
   ```
   This calls `wrangler deploy` under the hood.

## Directory Structure

Below is an abbreviated overview of the relevant files:

- **`.dev.vars`**  
  Contains local development environment variables (e.g., AI credentials).

- **`wrangler.jsonc`**  
  Cloudflare Worker configuration. Declares the Durable Object namespace `TASK_MANAGER_AGENT`, the AI binding `AI`, and migration steps for the Durable Object.

- **`package.json`**  
  Defines the project scripts:
  - **`deploy`** → Deploys via Cloudflare Wrangler
  - **`dev`** → Runs in local dev mode
  - **`lint`** → Checks code with Biome
  - **`test`** → Runs tests with Vitest
  - **`type-check`** → Runs `tsc` without emitting files

- **`vitest.config.ts`**  
  Vitest configuration.

- **`src/TaskManagerAgent.ts`**  
  Durable Object code. Manages the internal state of tasks and interfaces with the AI for task interpretation.

- **`src/index.ts`**  
  The main entry point. Creates the Hono server, configures CORS, and defines the `/` POST endpoint that interacts with the Durable Object.

- **`src/types/...`**  
  Type definitions for Hono and environment bindings.

## Example Usage

1. **Adding a Task**
   ```bash
   curl -X POST http://localhost:8787/ \
     -H "Content-Type: application/json" \
     -d '{
       "agentId": "demo-agent",
       "prompt": "Please add a new task to fix my website's homepage"
     }'
   ```

2. **Deleting a Task**
   ```bash
   curl -X POST http://localhost:8787/ \
     -H "Content-Type: application/json" \
     -d '{
       "agentId": "demo-agent",
       "prompt": "Delete the task titled 'fix my website's homepage'"
     }'
   ```

3. **Listing Tasks**
   ```bash
   curl -X POST http://localhost:8787/ \
     -H "Content-Type: application/json" \
     -d '{
       "agentId": "demo-agent",
       "prompt": "Please show all my tasks"
     }'
   ```

## Testing and Linting

- **Run Tests:**
  ```bash
  npm run test
  ```
- **Lint Code:**
  ```bash
  npm run lint
  ```
- **Type Check:**
  ```bash
  npm run type-check
  ```

We hope you find the Agent Task Manager both entertaining and practical. Whether you need to keep track of complex projects or simply remove that lingering to-do item, this worker has you covered with AI-driven intelligence and a straightforward JSON API. Enjoy your new, automated task manager!
